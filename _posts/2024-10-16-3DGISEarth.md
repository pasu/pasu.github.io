---
layout: post
title: Terrain
date: 2024-05-08 11:01:00
tags: 3D GIS Terrain
categories: 3DGIS
---

## 地球建模

地球并不是一个完美的球体，而是一个不规则的椭球体。地球在赤道的半径略大于极地的半径，因此我们用椭球模型来表示地球的形状。这种椭球模型（例如 WGS84 模型）能比圆球模型提供更高的精度。

**1. WGS84 概述**
WGS84 是世界大地测量系统1984 (World Geodetic System 1984) 的简称，是一种用于全球导航卫星系统的标准化地理坐标系。它基于地球的椭球模型，定义了地球的形状和大小，用来精确地确定全球的坐标。

**2. 圆球与椭球**
地球的模型可以用球体或椭球体表示。球体模型较为简单，但精度不足。WGS84 使用椭球模型，将地球表示为赤道半径较长、极地半径较短的椭球体。其赤道半径约为 6378137 米，极地半径约为 6356752.3142 米。

**3. Geodetic 与 Geocentric 的区别**
- **Geodetic 坐标系**：大地坐标系下，纬度定义为垂直于椭球表面的法线与赤道平面的夹角。
- **Geocentric 坐标系**：地心坐标系下，纬度定义为从地球中心指向该点的向量与赤道平面的夹角。

两者在大部分地球表面并不相同，尤其在纬度大于45度的区域，两者的角度差异更为显著。

### Geographic to WGS84
将地理坐标（经度 $\lambda$，纬度 $\phi$，高度 $h$ 转换为 WGS84 的笛卡尔坐标系$（X, Y, Z）$ 使用以下公式：

步骤：
1. 计算法线方向：
   $
   N(\phi) = \frac{a}{\sqrt{1 - e^2 \sin^2(\phi)}}
   $
   其中，$a$ 是椭球的长半轴（赤道半径），$e$ 是椭球的偏心率，计算公式为：
   $
   e = \sqrt{1 - \frac{b^2}{a^2}}
   $

2. 转换为笛卡尔坐标系：

   $
   X = (N(\phi) + h) \cos(\phi) \cos(\lambda)
   $

   $
   Y = (N(\phi) + h) \cos(\phi) \sin(\lambda)
   $

   $
   Z = \left(\left(1 - e^2\right)N(\phi) + h\right) \sin(\phi)
   $

   这里，h 是相对于椭球表面的高度。

### WGS84 to Geographic

从 WGS84 坐标系 $(X, Y, Z)$转换为地理坐标没有解析解（closed form），因此需要使用迭代方法。Newton-Raphson 方法是常用的一种快速收敛的迭代算法。

#### Newton-Raphson 方法

迭代方法旨在找到纬度 $\phi$，其基本公式为：

$
\phi_{n+1} = \phi_n - \frac{f(\phi_n)}{f'(\phi_n)}
$

在这个问题中，$f(\phi)$ 表示椭球表面上的几何关系，$f^\prime(\phi)$ 是该函数的导数。通过多次迭代，可以快速接近准确的纬度值。

### 椭球面上曲线采样点的计算

在椭球面上计算曲线的采样点时，通常根据参数化的曲线表达式，沿曲线均匀或按特定规则分布多个点。一个常见的做法是：

1. 使用椭球的参数方程，指定起点和终点的经纬度。
2. 通过插值计算中间点的经度和纬度。
3. 对每个插值点，应用 Geographic to WGS84 的转换公式，将地理坐标转换为 WGS84 坐标系下的 $(X, Y, Z)$ 坐标。

这种方法可以确保在椭球表面上生成精确的曲线采样点，用于渲染或进一步计算。